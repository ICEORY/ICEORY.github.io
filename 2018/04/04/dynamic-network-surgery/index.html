<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">






  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="sparse connections," />










<meta name="description" content="In this paper, the authors proposed dynamic network surgery to prune unimportant connections of the network. Different from previous methods, the proposed method contains two operations: pruning and">
<meta name="keywords" content="sparse connections">
<meta property="og:type" content="article">
<meta property="og:title" content="DNS (Dynamic Network Surgery)">
<meta property="og:url" content="http://iceory.com/2018/04/04/dynamic-network-surgery/index.html">
<meta property="og:site_name" content="iceory&#39;s blog">
<meta property="og:description" content="In this paper, the authors proposed dynamic network surgery to prune unimportant connections of the network. Different from previous methods, the proposed method contains two operations: pruning and">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://iceory.com/2018/04/04/dynamic-network-surgery/Overview%20of%20DNS.png">
<meta property="og:updated_time" content="2018-04-04T08:45:46.107Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DNS (Dynamic Network Surgery)">
<meta name="twitter:description" content="In this paper, the authors proposed dynamic network surgery to prune unimportant connections of the network. Different from previous methods, the proposed method contains two operations: pruning and">
<meta name="twitter:image" content="http://iceory.com/2018/04/04/dynamic-network-surgery/Overview%20of%20DNS.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://iceory.com/2018/04/04/dynamic-network-surgery/"/>





  <title>DNS (Dynamic Network Surgery) | iceory's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">iceory's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://iceory.com/2018/04/04/dynamic-network-surgery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="iceory">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iceory's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DNS (Dynamic Network Surgery)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-04T15:38:43+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network-quantization/" itemprop="url" rel="index">
                    <span itemprop="name">network quantization</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <p><img src="/2018/04/04/dynamic-network-surgery/Overview of DNS.png" alt="Overview of DNS"></p>
<p>In this paper, the authors proposed dynamic network surgery to prune unimportant connections of the network. Different from previous methods, the proposed method contains two operations: <strong>pruning</strong> and <strong>splicing</strong>. Considering the complexity of deep neural networks, it is difficult to decide which connection is important and which one should be pruned. Thus the splicing operation is to recover the pruned weights that are found to be important during training phase. In contrary, weights are pruned with no chance to come back in previous methods, and that may lead to severe loss of accuracy.<br><a id="more"></a></p>
<h2 id="Pruning-and-Splicing"><a href="#Pruning-and-Splicing" class="headerlink" title="Pruning and Splicing"></a>Pruning and Splicing</h2><p>Suppose $W_k$ represents weights of a DNN model, and mask $T_k(i,j)\in {0,1}$ denotes the states of connections of network. The optimize object can be formulated as follows:<br>$$<br>\min_{W_k, T_k} L(W_k\odot T_k)~s.t. T_k^{(i, j)}=h_k(W_k^{(i, j)}), \forall (i,j)\in \mathcal{I}, \tag{1}<br>$$<br>where $L(\cdot)$ denotes the loss function, $\odot$ indicates the <a href="https://en.wikipedia.org/wiki/Hadamard_product_(matrices" target="_blank" rel="noopener">Hadamard product operator</a>), $\mathcal{I}$ represents every entry of weight matrixes and $h_k(W_k^{(i,j)})$ evaluates the importance of connections in the network. The definition of $h_k$ is shown as follows:<br>$$<br>h_k(W_k^{(i,j)}) =<br>\begin{cases}<br>0 &amp; if~a_k\gt|W_k^{(i,j)}| \<br>T_k^{(i,j)}  &amp; if~a_k\le |W_k^{(i,j)}| \lt b_k \<br>1 &amp; if~b_k\le |W_k^{(i,j)}|<br>\end{cases}\tag{2}<br>$$<br>$a_k$ and $b_k$ in Equation (2) are two thresholds for improving the robustness of the proposed method. Note that if $|W_k^{(i,j)}|\in [a_k, b_k]$, the state of $T_k^{(i,j)}$ would not be changed. This Equation is applied to the network to re-evaluate all the weights before training phase. Thus the pruned weights can be spliced if they are evaluated as important connections.</p>
<p>Further more, the thresholds $a_k$ and $b_k$ are computed by the following equations according to <a href="https://github.com/yiwenguo/Dynamic-Network-Surgery" target="_blank" rel="noopener">source code</a> on GitHub:<br>$$<br>a_k = 0.9*(mean(W_k)+cRate*std(W_k)),\<br>b_k = 1.1*(mean(W_k)+cRate*std(W_k)), \tag{3}<br>$$<br>where $cRate$ is the factor deciding the compressing rate of the model. Larger $cRate$ leads to higher compression rate with more loss of accuracy.</p>
<p>After $T_k$ is obtained by Equation (2), we can train the network with full training phase and update weights $W_k$ with the following scheme:<br>$$<br>W_k^{i,j} \gets W_k^{(i,j)}-\beta \frac{\partial}{\partial(W_k^{(i,j)}T_k^{(i,j)})}L(W_k\odot T_k), \forall(i,j)\in \mathcal{I} \tag{4}<br>$$<br>Considering the convergence of the proposed method, the authors suggest that the frequencies of pruning and splicing can be slowed down with a monotonically non-increasing function $\sigma(\cdot)$ which indicates the probability of mask $T_k$ that to be modified in single training iteration. With amount of training iterations, the value of $\sigma$ may even decreased to zero, and the pruning and splicing to the network will be stopped.</p>
<h3 id="important-tips"><a href="#important-tips" class="headerlink" title="important tips"></a>important tips</h3><ul>
<li>The computation of thresholds only applied at the very beginning, and would not be change after that</li>
<li>Considering the gradient vanishing problem, the authors prune convolutional layers and fully connected layers separately, which is similar to <a href="http://papers.nips.cc/paper/5784-learning-both-weights-and-connections-for-efficient-neural-network.pdf" target="_blank" rel="noopener">Han’s paper</a></li>
<li>Pruned weights would also be updated during training</li>
</ul>
<h2 id="Implementation-in-PyTorch"><a href="#Implementation-in-PyTorch" class="headerlink" title="Implementation in PyTorch"></a>Implementation in PyTorch</h2><p><strong>Prepare: </strong> pre-train a DNN model</p>
<p><strong>Step 1, pruning and splicing: </strong> compute $a_k$ and $b_k$ by Equation (3) and update mask $T_k$ by Equation (2) with probability of $\sigma(iter)$</p>
<p><strong>Step 2, training: </strong> adopt forward and backward propagation and compute Loss and Gradient</p>
<p><strong>Step 3, updating: </strong> update weights of the model with mask $T_k$ using SGD</p>
<p><strong>Repeating: </strong> repeating step 1 to step 3 until the number of inter reaches its maximum</p>
<h2 id="Experimental-Results"><a href="#Experimental-Results" class="headerlink" title="Experimental Results"></a>Experimental Results</h2><p>The authors conducted experiments on several models including LeNet-5, LeNet-300-100 and AlexNet. The experimental results can be summarized as follows:</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Top-1 Error</th>
<th>Parameters</th>
<th>Iterations</th>
<th>Compression</th>
</tr>
</thead>
<tbody>
<tr>
<td>LeNet-5 reference</td>
<td>0.91%</td>
<td>431K</td>
<td>10K</td>
<td></td>
</tr>
<tr>
<td>LeNet-5 pruned</td>
<td>0.91%</td>
<td>4.0K</td>
<td>16K</td>
<td>108$\times$</td>
</tr>
<tr>
<td>LeNet-100-300 reference</td>
<td>2.28%</td>
<td>267K</td>
<td>10K</td>
<td></td>
</tr>
<tr>
<td>LeNet-100-300 pruned</td>
<td>1.99%</td>
<td>4.8K</td>
<td>25K</td>
<td>56$\times$</td>
</tr>
<tr>
<td>AlexNet reference</td>
<td>43.42%/-</td>
<td>61M</td>
<td>450K</td>
<td></td>
</tr>
<tr>
<td>AlexNet pruned</td>
<td>43.09%/19.99%</td>
<td>3.45M</td>
<td>700K</td>
<td>17.7$\times$</td>
</tr>
</tbody>
</table>
<p>More detail comparison with work of Han et. al. on AlexNet using single crop validation on ImageNet are shown as follows:</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Parameters</th>
<th>Remaining Parameters Rate of Han et. al.(%)</th>
<th>Remaining Parameters Rate(%)</th>
</tr>
</thead>
<tbody>
<tr>
<td>conv1</td>
<td>35K</td>
<td>~84%</td>
<td>53.8%</td>
</tr>
<tr>
<td>conv2</td>
<td>307K</td>
<td>~38%</td>
<td>40.6%</td>
</tr>
<tr>
<td>conv3</td>
<td>885K</td>
<td>~35%</td>
<td>29.0%</td>
</tr>
<tr>
<td>conv4</td>
<td>664K</td>
<td>~37%</td>
<td>32.3%</td>
</tr>
<tr>
<td>conv5</td>
<td>443K</td>
<td>~37%</td>
<td>32.5%</td>
</tr>
<tr>
<td>fc1</td>
<td>38M</td>
<td>~9%</td>
<td>3.7%</td>
</tr>
<tr>
<td>fc2</td>
<td>17M</td>
<td>~9%</td>
<td>6.6%</td>
</tr>
<tr>
<td>fc3</td>
<td>4M</td>
<td>~25%</td>
<td>4.6%</td>
</tr>
<tr>
<td>Total</td>
<td>61M</td>
<td>~11%</td>
<td>5.7%</td>
</tr>
</tbody>
</table>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    iceory
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://iceory.com/2018/04/04/dynamic-network-surgery/" title="DNS (Dynamic Network Surgery)">http://iceory.com/2018/04/04/dynamic-network-surgery/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/sparse-connections/" rel="tag"># sparse connections</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/04/deep-compression/" rel="next" title="Deep Compression">
                <i class="fa fa-chevron-left"></i> Deep Compression
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/04/incremental-network-quantization/" rel="prev" title="INQ (Incremental Network Quantization)">
                INQ (Incremental Network Quantization) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">iceory</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pruning-and-Splicing"><span class="nav-number">1.</span> <span class="nav-text">Pruning and Splicing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#important-tips"><span class="nav-number">1.1.</span> <span class="nav-text">important tips</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implementation-in-PyTorch"><span class="nav-number">2.</span> <span class="nav-text">Implementation in PyTorch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Experimental-Results"><span class="nav-number">3.</span> <span class="nav-text">Experimental Results</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">iceory</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
